{"version":3,"file":"js/542.8fa34e83.js","mappings":"syDA6HI,MAAMA,GAASC,EAAAA,EAAAA,MAETC,GAAUC,EAAAA,EAAAA,IAAI,IACdC,GAAWD,EAAAA,EAAAA,IAAI,IACfE,GAAWF,EAAAA,EAAAA,IAAI,IACfG,GAAcH,EAAAA,EAAAA,IAAI,IAClBI,GAAcJ,EAAAA,EAAAA,IAAI,IAClBK,GAAkBL,EAAAA,EAAAA,IAAI,IAEtBM,GAAON,EAAAA,EAAAA,IAAIO,MAMjBC,eAAeC,UACOC,GAAdJ,EAAKK,OAITC,EAAAA,EAAAA,IAAWN,EAAKK,MAAOL,EAAKK,MAAME,MAH9Bd,EAAQY,MAAQ,QAIxB,CAEA,SAASG,GAAYC,QACCL,GAAdJ,EAAKK,OAITL,EAAKK,MAAQI,EAAMC,OAAOC,MAAM,GAE5BX,EAAKK,QACLV,EAASU,MAAQO,IAAIC,gBAAgBb,EAAKK,SAN1CZ,EAAQY,MAAQ,QAQxB,CAEAH,eAAeY,KAEX,GADAC,QAAQC,IAAIpB,EAASS,QAChBT,EAASS,MAEV,YADAZ,EAAQY,MAAQ,YAIpB,IAAKT,EAASS,MAAMY,SAAS,KAEzB,YADAxB,EAAQY,MAAQ,cAGpB,MAAMa,QAAeC,EAAAA,EAAAA,IAAYvB,EAASS,OAChB,KAAtBa,EAAOE,YACP7B,EAAO8B,KAAM,UAASC,aAAa,UAGnC7B,EAAQY,MAAQ,cAGxB,CAEAH,eAAeqB,KACX,GAAyB,IAArBzB,EAAYO,MAKZ,OAJAZ,EAAQY,MAAQ,UAChBP,EAAYO,MAAQ,GACpBR,EAAYQ,MAAQ,QACpBN,EAAgBM,MAAQ,IAG5B,GAAyB,IAArBR,EAAYQ,MAKZ,OAJAZ,EAAQY,MAAQ,UAChBP,EAAYO,MAAQ,GACpBR,EAAYQ,MAAQ,QACpBN,EAAgBM,MAAQ,IAG5B,GAA6B,IAAzBN,EAAgBM,MAKhB,OAJAZ,EAAQY,MAAQ,UAChBP,EAAYO,MAAQ,GACpBR,EAAYQ,MAAQ,QACpBN,EAAgBM,MAAQ,IAG5B,GAAIR,EAAYQ,OAASP,EAAYO,MAKjC,OAJAZ,EAAQY,MAAQ,cAChBP,EAAYO,MAAQ,GACpBR,EAAYQ,MAAQ,QACpBN,EAAgBM,MAAQ,IAG5B,GAAIP,EAAYO,OAASN,EAAgBM,MAKrC,OAJAZ,EAAQY,MAAQ,QAChBP,EAAYO,MAAQ,GACpBR,EAAYQ,MAAQ,QACpBN,EAAgBM,MAAQ,IAG5B,IAAK,MAAMmB,IAAK,CAAC1B,EAAYO,MAAON,EAAgBM,MAAOR,EAAYQ,OACnE,GAAImB,EAAEC,OAAS,EAKX,OAJAhC,EAAQY,MAAQ,aAChBP,EAAYO,MAAQ,GACpBR,EAAYQ,MAAQ,QACpBN,EAAgBM,MAAQ,IAKhC,MAAMqB,GAAmBC,EAAAA,EAAAA,IAAW7B,EAAYO,OAE1CuB,GAAmBD,EAAAA,EAAAA,IAAW9B,EAAYQ,OAE1Ca,QAAeW,EAAAA,EAAAA,IAAgBD,EAAkBF,GAEvD,GAA0B,KAAtBR,EAAOE,YAKX,OAA0B,KAAtBF,EAAOE,aACPE,aAAaQ,aACbvC,EAAOwC,QAAQ,WAIO,KAAtBb,EAAOE,aACPtB,EAAYO,MAAQ,GACpBR,EAAYQ,MAAQ,GACpBN,EAAgBM,MAAQ,QACxBZ,EAAQY,MAAQ,eAJpB,EAVIZ,EAAQY,MAAQ,sBAAwBa,EAAO,oBAiBvD,C,OAnHAc,EAAAA,EAAAA,KAAU9B,UACNP,EAASU,YAAc4B,EAAAA,EAAAA,KAAqB,I,wtECtIpD,MAAMC,EAAc,EAEpB,O","sources":["webpack://pms/./src/components/ProfileView.vue","webpack://pms/./src/components/ProfileView.vue?77aa"],"sourcesContent":["<template>\r\n    <div class=\"col mb-3\">\r\n        <div class=\"col-lg\">\r\n            <div class=\"row\">\r\n                <div class=\"col\">\r\n                    <div class=\"card shadow my-3\">\r\n                        <div class=\"card-header py-3\">\r\n                            <p class=\"text-primary m-0 fw-bold\" style=\"font-size: 28px;\">個人檔案</p>\r\n                        </div>\r\n                        <div class=\"card-body text-center\">\r\n                            <div class=\"row\">\r\n                                <div class=\"col\">\r\n                                    <img id=\"main_image\" class=\"rounded-circle mb-3 mt-4\" width=\"160\" height=\"160\" :src=\"imageURL\">\r\n                                </div>\r\n                                <div class=\"col d-flex align-items-center justify-content-center\">\r\n                                    <div class=\"w-100\">\r\n                                        <strong>更改圖片</strong>\r\n                                        <input @change=\"changeImage\" class=\"form-control shadow-none\" type=\"file\" accept=\"image/*\">\r\n                                    </div>\r\n                                </div>\r\n                                <div class=\"text-end\">\r\n                                    <button @click=\"uploadImage\" class=\"btn btn-primary btn-sm shadow-none\">\r\n                                        <i class=\"fa fa-save\"></i>\r\n                                        &nbsp;儲存\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-lg\">\r\n            <div class=\"row\">\r\n                <div class=\"col\">\r\n                    <div class=\"card shadow my-3\">\r\n                        <div class=\"card-header py-3\">\r\n                            <p class=\"text-primary m-0 fw-bold\" style=\"font-size: 28px;\">更改電郵</p>\r\n                        </div>\r\n                        <div class=\"card-body\">\r\n                            <form>\r\n                                <div class=\"mb-3\">\r\n                                    <label class=\"form-label\">\r\n                                        <strong>新電郵</strong>\r\n                                    </label>\r\n                                    <input v-model=\"newEmail\" class=\"form-control shadow-none\" type=\"email\" autocomplete=\"current-password\" required=\"\">\r\n                                </div>\r\n                                <div class=\"text-end mb-3\">\r\n                                    <button @click=\"changeEmail_\" class=\"btn btn-primary btn-sm shadow-none\" type=\"submit\">\r\n                                        <i class=\"fa fa-save\"></i>\r\n                                        &nbsp;儲存\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-lg\">\r\n            <div class=\"row\">\r\n                <div class=\"col\">\r\n                    <div class=\"card shadow my-3\">\r\n                        <div class=\"card-header py-3\">\r\n                            <p class=\"text-primary m-0 fw-bold\" style=\"font-size: 28px;\">更改密碼</p>\r\n                        </div>\r\n                        <form>\r\n                            <input\r\n                                type=\"text\"\r\n                                name=\"email\"\r\n                                value=\"...\"\r\n                                autocomplete=\"username email\"\r\n                                style=\"display: none;\"\r\n                            >\r\n                            <div class=\"card-body\">\r\n                                <div class=\"mb-3\">\r\n                                    <label class=\"form-label\">\r\n                                        <strong>舊密碼</strong>\r\n                                    </label>\r\n                                    <input v-model=\"oldPassword\" class=\"form-control shadow-none\" type=\"password\" autocomplete=\"current-password\" show=\"*\" minlength=\"8\" maxlength=\"50\" required=\"\">\r\n                                </div>\r\n                                <div class=\"row\">\r\n                                    <div class=\"col\">\r\n                                        <div class=\"mb-3\">\r\n                                            <label class=\"form-label\">\r\n                                                <strong>新密碼</strong>\r\n                                            </label>\r\n                                        <input v-model=\"newPassword\" class=\"form-control shadow-none\" autocomplete=\"new-password\" show=\"*\" type=\"password\" minlength=\"8\" maxlength=\"50\" required=\"\">\r\n                                    </div>\r\n                                    </div>\r\n                                    <div class=\"col\">\r\n                                        <div class=\"mb-3\">\r\n                                            <label class=\"form-label\">\r\n                                                <strong>確認密碼</strong>\r\n                                            </label>\r\n                                            <input v-model=\"confirmPassword\" autocomplete=\"confirm-password\" class=\"form-control shadow-none\" show=\"*\" type=\"password\" minlength=\"8\" maxlength=\"50\" required=\"\">\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div class=\"text-end mb-3\">\r\n                                    <button @click=\"changePassword\" class=\"btn btn-primary btn-sm shadow-none\" type=\"submit\">\r\n                                        <i class=\"fa fa-save\"></i>\r\n                                        &nbsp;儲存\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <AlertBlock :message=\"message\" @closeBlock=\"message=``\" />\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n    import { getProfileIconImage  } from \"@/assets/js/helper.js\"\r\n    import { changePassword_ } from \"@/assets/js/helper.js\"\r\n    import { changeEmail } from \"@/assets/js/helper.js\"\r\n    import { changeIcon } from \"@/assets/js/helper.js\"\r\n    import { HashSHA256 } from \"@/assets/js/helper.js\"\r\n    import { useRouter } from \"vue-router\"\r\n    import { onMounted } from \"vue\"\r\n    import { ref } from \"vue\"\r\n\r\n    const router = useRouter()\r\n\r\n    const message = ref(\"\")\r\n    const imageURL = ref(\"\")\r\n    const newEmail = ref(\"\")\r\n    const oldPassword = ref(\"\")\r\n    const newPassword = ref(\"\")\r\n    const confirmPassword = ref(\"\")\r\n\r\n    const file = ref(File)\r\n\r\n    onMounted(async () => {\r\n        imageURL.value = await getProfileIconImage()\r\n    })\r\n\r\n    async function uploadImage() {\r\n        if (file.value == undefined) {\r\n            message.value = \"沒有選取圖片\"\r\n            return\r\n        }\r\n        changeIcon(file.value, file.value.name)\r\n    }\r\n\r\n    function changeImage(event) {\r\n        if (file.value == undefined) {\r\n            message.value = \"沒有選取圖片\"\r\n            return\r\n        }\r\n        file.value = event.target.files[0]\r\n\r\n        if (file.value) {\r\n            imageURL.value = URL.createObjectURL(file.value)\r\n        }\r\n    }\r\n\r\n    async function changeEmail_() {\r\n        console.log(newEmail.value)\r\n        if (!newEmail.value) {\r\n            message.value = \"Email 為空\"\r\n            return\r\n        }\r\n\r\n        if (!newEmail.value.includes(\"@\")) {\r\n            message.value = \"Email 格式錯誤\"\r\n            return\r\n        }\r\n        const status = await changeEmail(newEmail.value)\r\n        if (status.status_code == 200) {\r\n            router.push(`/about/${localStorage[\"nid\"]}`)\r\n        }\r\n        else {\r\n            message.value = \"Server Error\"\r\n            return\r\n        }\r\n    }\r\n\r\n    async function changePassword() {\r\n        if (newPassword.value == \"\") {\r\n            message.value = \"新密碼不能為空\"\r\n            newPassword.value = \"\"\r\n            oldPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            return\r\n        }\r\n        if (oldPassword.value == \"\") {\r\n            message.value = \"舊密碼不能為空\"\r\n            newPassword.value = \"\"\r\n            oldPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            return\r\n        }\r\n        if (confirmPassword.value == \"\") {\r\n            message.value = \"舊密碼不能為空\"\r\n            newPassword.value = \"\"\r\n            oldPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            return\r\n        }\r\n        if (oldPassword.value == newPassword.value) {\r\n            message.value = \"新密碼不能與舊密碼一致\"\r\n            newPassword.value = \"\"\r\n            oldPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            return\r\n        }\r\n        if (newPassword.value != confirmPassword.value) {\r\n            message.value = \"密碼不一致\"\r\n            newPassword.value = \"\"\r\n            oldPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            return\r\n        }\r\n        for (const i of [newPassword.value, confirmPassword.value, oldPassword.value]) {\r\n            if (i.length < 8) {\r\n                message.value = \"密碼至少8個字元以上\"\r\n                newPassword.value = \"\"\r\n                oldPassword.value = \"\"\r\n                confirmPassword.value = \"\"\r\n                return\r\n            }\r\n        }\r\n\r\n        const newHash_password = HashSHA256(newPassword.value)\r\n\r\n        const oldHash_password = HashSHA256(oldPassword.value)\r\n\r\n        const status = await changePassword_(oldHash_password, newHash_password)\r\n\r\n        if (status.status_code == 400) {\r\n            message.value = \"SQLInjectionCheck: \" + status[\"SQLInjectionCheck\"]\r\n            return\r\n        }\r\n\r\n        if (status.status_code == 200) {\r\n            localStorage.clear()\r\n            router.replace(\"/login\")\r\n            return\r\n        }\r\n\r\n        if (status.status_code == 400) {\r\n            newPassword.value = \"\"\r\n            oldPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            message.value = \"密碼不正確\"\r\n            return\r\n        }\r\n    }\r\n</script>\r\n","import script from \"./ProfileView.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ProfileView.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["router","useRouter","message","ref","imageURL","newEmail","oldPassword","newPassword","confirmPassword","file","File","async","uploadImage","undefined","value","changeIcon","name","changeImage","event","target","files","URL","createObjectURL","changeEmail_","console","log","includes","status","changeEmail","status_code","push","localStorage","changePassword","i","length","newHash_password","HashSHA256","oldHash_password","changePassword_","clear","replace","onMounted","getProfileIconImage","__exports__"],"sourceRoot":""}