{"version":3,"file":"js/163.0ecd6e75.js","mappings":"s8BAyDI,MAAMA,GAASC,EAAAA,EAAAA,MAETC,GAAMC,EAAAA,EAAAA,IAAI,IACVC,GAAUD,EAAAA,EAAAA,IAAI,IACdE,GAAcF,EAAAA,EAAAA,IAAI,IAClBG,GAAkBH,EAAAA,EAAAA,IAAI,IAS5BI,eAAeC,IAEX,GAAIH,EAAYI,OAASH,EAAgBG,MAIrC,OAHAL,EAAQK,MAAQ,QAChBJ,EAAYI,MAAQ,QACpBH,EAAgBG,MAAQ,IAG5B,GAAyB,IAArBJ,EAAYI,MAIZ,OAHAL,EAAQK,MAAQ,UAChBJ,EAAYI,MAAQ,QACpBH,EAAgBG,MAAQ,IAG5B,GAA6B,IAAzBH,EAAgBG,MAIhB,OAHAL,EAAQK,MAAQ,UAChBJ,EAAYI,MAAQ,QACpBH,EAAgBG,MAAQ,IAI5B,GAAIJ,EAAYI,MAAMC,OAAS,GAAKJ,EAAgBG,MAAMC,OAAS,EAI/D,OAHAN,EAAQK,MAAQ,aAChBJ,EAAYI,MAAQ,QACpBH,EAAgBG,MAAQ,IAK5B,IAAIE,EAAa,IAAIC,YACrB,MAAMC,EAAUF,EAAWG,OAAOT,EAAYI,OACxCM,QAAgBC,OAAOC,OAAOC,OAAO,UAAWL,GAChDM,EAAgBC,MAAMC,KAAK,IAAIC,WAAWP,IAC1CQ,EAAcJ,EAAcK,KAAKC,GAAMA,EAAEC,SAAS,IAAIC,SAAS,EAAG,OAAMC,KAAK,IAC7EC,EAAmBN,EAEnBO,QAAgBC,EAAAA,EAAAA,IAAoB7B,EAAIO,MAAOoB,GAEvB,KAA1BC,EAAQ,eACR1B,EAAQK,MAAQ,OAGhBL,EAAQK,MAAQqB,CAExB,C,OAnDAE,EAAAA,EAAAA,KAAUzB,UAC4B,SAAxB0B,EAAAA,EAAAA,QACNjC,EAAOkC,QAAQ,cACfC,QAAQC,IAAI,MAChB,I,qsCCjER,MAAMC,EAAc,EAEpB,O","sources":["webpack://pms/./src/components/Administration/PasswordView.vue","webpack://pms/./src/components/Administration/PasswordView.vue?70f6"],"sourcesContent":["<template>\r\n    <div class=\"col-lg\">\r\n        <div class=\"row\">\r\n            <div class=\"col\">\r\n                <div class=\"card shadow my-3\">\r\n                    <div class=\"card-header py-3\">\r\n                        <p class=\"text-primary m-0 fw-bold\" style=\"font-size: 28px;\">更改密碼</p>\r\n                    </div>\r\n                    <form>\r\n                        <input type=\"text\" name=\"\" autocomplete=\"\" value=\"...\" style=\"display: none;\">\r\n                        <div class=\"card-body\">\r\n                            <div class=\"mb-3\">\r\n                                <label class=\"form-label\">\r\n                                    <strong>學號</strong>\r\n                                </label>\r\n                                <input v-model=\"nid\" class=\"form-control shadow-none\" type=\"text\" autocomplete=\"current-password\" minlength=\"8\" maxlength=\"50\" required=\"\">\r\n                            </div>\r\n                            <div class=\"row\">\r\n                                <div class=\"col\">\r\n                                    <div class=\"mb-3\">\r\n                                        <label class=\"form-label\">\r\n                                            <strong>新密碼</strong>\r\n                                        </label>\r\n                                    <input v-model=\"newPassword\" class=\"form-control shadow-none\" autocomplete=\"new-password\" show=\"*\" type=\"password\" minlength=\"8\" maxlength=\"50\" required=\"\">\r\n                                </div>\r\n                                </div>\r\n                                <div class=\"col\">\r\n                                    <div class=\"mb-3\">\r\n                                        <label class=\"form-label\">\r\n                                            <strong>確認密碼</strong>\r\n                                        </label>\r\n                                        <input v-model=\"confirmPassword\" autocomplete=\"confirm-password\" class=\"form-control shadow-none\" show=\"*\" type=\"password\" minlength=\"8\" maxlength=\"50\" required=\"\">\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"text-end\">\r\n                                <button @click=\"changePassword\" class=\"btn btn-primary btn-sm shadow-none\" type=\"submit\">\r\n                                    <i class=\"fa fa-save\"></i>\r\n                                    &nbsp;儲存\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <AlertBlock :message=\"message\" @closeBlock=\"message=``\" />\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n    import { forceChangePassword } from \"@/assets/js/helper.js\"\r\n    import { getPermissionLevel } from \"@/assets/js/helper.js\"\r\n    import { useRouter } from \"vue-router\"\r\n    import { onMounted } from \"vue\"\r\n    import { ref } from \"vue\"\r\n\r\n    const router = useRouter()\r\n\r\n    const nid = ref(\"\")\r\n    const message = ref(\"\")\r\n    const newPassword = ref(\"\")\r\n    const confirmPassword = ref(\"\")\r\n\r\n    onMounted(async () => {\r\n        if (await getPermissionLevel() != 3) {\r\n            router.replace(\"/dashboard\")\r\n            console.log(\":<\")\r\n        }\r\n    })\r\n\r\n    async function changePassword() {\r\n        // error checking\r\n        if (newPassword.value != confirmPassword.value) {\r\n            message.value = \"密碼不一致\"\r\n            newPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            return\r\n        }\r\n        if (newPassword.value == \"\") {\r\n            message.value = \"新密碼不能為空\"\r\n            newPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            return\r\n        }\r\n        if (confirmPassword.value == \"\") {\r\n            message.value = \"舊密碼不能為空\"\r\n            newPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            return\r\n        }\r\n\r\n        if (newPassword.value.length < 8 || confirmPassword.value.length < 8) {\r\n            message.value = \"密碼至少8個字元以上\"\r\n            newPassword.value = \"\"\r\n            confirmPassword.value = \"\"\r\n            return\r\n        }\r\n\r\n        // hash password\r\n        let newEncoder = new TextEncoder();\r\n        const newData = newEncoder.encode(newPassword.value);\r\n        const newHash = await crypto.subtle.digest(\"SHA-256\", newData);\r\n        const newHash_array = Array.from(new Uint8Array(newHash));\r\n        const newHash_hex = newHash_array.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n        const newHash_password = newHash_hex;\r\n\r\n        const success = await forceChangePassword(nid.value, newHash_password)\r\n\r\n        if (success[\"status_code\"] == 200) {\r\n            message.value = \"更改成功\"\r\n        }\r\n        else {\r\n            message.value = success\r\n        }\r\n    }\r\n</script>\r\n","import script from \"./PasswordView.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./PasswordView.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["router","useRouter","nid","ref","message","newPassword","confirmPassword","async","changePassword","value","length","newEncoder","TextEncoder","newData","encode","newHash","crypto","subtle","digest","newHash_array","Array","from","Uint8Array","newHash_hex","map","b","toString","padStart","join","newHash_password","success","forceChangePassword","onMounted","getPermissionLevel","replace","console","log","__exports__"],"sourceRoot":""}