{"version":3,"file":"js/461.8a6cb4d9.js","mappings":"iiBAmCI,MAAMA,GAAeC,EAAAA,EAAAA,IAAI,IACnBC,GAAWD,EAAAA,EAAAA,IAAI,IACfE,GAAUF,EAAAA,EAAAA,IAAI,IACdG,GAAMH,EAAAA,EAAAA,IAAI,IAEVI,GAASC,EAAAA,EAAAA,MAEfC,eAAeC,IACX,GAAkB,KAAdJ,EAAIK,MAEJ,YADAN,EAAQM,MAAQ,UAGpB,GAAuB,KAAnBP,EAASO,MAET,YADAN,EAAQM,MAAQ,SAIpBL,EAAIK,MAAQL,EAAIK,MAAMC,cACtBV,EAAaS,OAAQE,EAAAA,EAAAA,IAAWT,EAASO,OACzC,MAAMG,QAAiBC,EAAAA,EAAAA,IAAYT,EAAIK,MAAOT,EAAaS,OAEtDG,EAAS,YACVT,EAAQM,MAAQ,gBAIhBG,EAASE,QACTC,aAAa,OAASX,EAAIK,MAAMO,oBAChCD,aAAa,SAAWH,EAASK,MAAM,wBACjCC,EAAAA,EAAAA,MACNb,EAAOc,QAAQ,eAEfhB,EAAQM,MAAQ,WAGxB,C,OAEAW,EAAAA,EAAAA,KAAUb,UACN,IAAIc,EAAAA,EAAAA,MAAe,CACf,MAAMC,QAAsBC,EAAAA,EAAAA,MAExBD,EAAcR,OACdT,EAAOmB,IAAI,IAGXT,aAAa,OAAS,KACtBA,aAAa,SAAW,KACxBV,EAAOc,QAAQ,KAEvB,K,y2BCjFR,MAAMM,EAAc,EAEpB,O","sources":["webpack://pms/./src/components/LoginView.vue","webpack://pms/./src/components/LoginView.vue?3311"],"sourcesContent":["<template>\r\n    <div>\r\n        <section id=\"login-page\" class=\"login-dark fixed-top\" style=\"backdrop-filter: blur(10px)\" >\r\n            <form method=\"post\" style=\"background: rgba(15,25,35,0.9)\">\r\n                <div class=\"illustration\">\r\n                    <i class=\"icon ion-ios-locked-outline\"></i>\r\n                </div>\r\n\r\n                <div class=\"mb-3\">\r\n                    <input v-model=\"nid\" @keyup.enter=\"login_func\" id=\"nid\" class=\"form-control\" type=\"text\" name=\"nid\" placeholder=\"NID\" style=\"border-bottom-color: rgb(112,128,146)\">\r\n                </div>\r\n\r\n                <div class=\"mb-3\">\r\n                    <input v-model=\"password\" @keyup.enter=\"login_func\" id=\"login_password\" autocomplete class=\"form-control\" type=\"password\" name=\"password\" placeholder=\"Password\">\r\n                </div>\r\n\r\n                <div class=\"mb-3\">\r\n                    <button @click=\"login_func\" class=\"btn btn-primary d-block w-100\" type=\"button\">登入</button>\r\n                </div>\r\n            </form>\r\n        </section>\r\n        <AlertBlock :message=\"message\" @closeBlock=\"message=``\" />\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n    import { getPermissionLevel } from \"@/assets/js/helper.js\"\r\n    import { getJWTToken } from \"@/assets/js/helper.js\"\r\n    import { JWTValidate } from \"@/assets/js/helper.js\"\r\n    import { verifyLogin } from \"@/assets/js/helper.js\"\r\n    import { HashSHA256 } from \"@/assets/js/helper.js\"\r\n    import { useRouter } from \"vue-router\"\r\n    import { onMounted } from \"vue\"\r\n    import { ref } from \"vue\"\r\n\r\n    const hashPassword = ref(\"\")\r\n    const password = ref(\"\")\r\n    const message = ref(\"\")\r\n    const nid = ref(\"\")\r\n\r\n    const router = useRouter()\r\n\r\n    async function login_func() {\r\n        if (nid.value === \"\") {\r\n            message.value = \"請輸入NID\"\r\n            return\r\n        }\r\n        if (password.value === \"\") {\r\n            message.value = \"請輸入密碼\"\r\n            return\r\n        }\r\n\r\n        nid.value = nid.value.toUpperCase()\r\n        hashPassword.value = HashSHA256(password.value)\r\n        const response = await verifyLogin(nid.value, hashPassword.value)\r\n\r\n        if (!response[\"access\"]) {\r\n            message.value = \"伺服器內部錯誤: 500\"\r\n        }\r\n\r\n        // Store jwt token to localStorage for future use\r\n        if (response.access) {\r\n            localStorage[\"nid\"] = nid.value.toLocaleUpperCase()\r\n            localStorage[\"token\"] = response.token[\"x-access-token\"]\r\n            await getPermissionLevel()\r\n            router.replace(\"/dashboard\")\r\n        } else {\r\n            message.value = \"用戶名或密碼不正確\"\r\n            return\r\n        }\r\n    }\r\n\r\n    onMounted(async () => {\r\n        if (getJWTToken()) {\r\n            const JWTValidation = await JWTValidate()\r\n\r\n            if (JWTValidation.access){\r\n                router.go(-1)\r\n            }\r\n            else {\r\n                localStorage[\"nid\"] = null\r\n                localStorage[\"token\"] = null\r\n                router.replace(\"/\")\r\n            }\r\n        }\r\n    })\r\n</script>\r\n","import script from \"./LoginView.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./LoginView.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["hashPassword","ref","password","message","nid","router","useRouter","async","login_func","value","toUpperCase","HashSHA256","response","verifyLogin","access","localStorage","toLocaleUpperCase","token","getPermissionLevel","replace","onMounted","getJWTToken","JWTValidation","JWTValidate","go","__exports__"],"sourceRoot":""}